<!DOCTYPE html>
<!-- saved from url=(0043)https://jakearchibald.com/scratch/alphavid/ -->
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>HTML5 Video with alpha transparency</title>
  <style>
    html {
      height: 100%;
    }

    body {
      height: 100%;
      margin: 0;
      padding: 0;
      background-color: black;
      font-family: arial, sans-serif;
    }

    video {
      position: fixed;
      top: 0;
      left: 0;
      width: 100px;
    }

    #buffer {
      /* display: none */
    }

    p {
      background: white;
    }
  </style>
</head>

<body
  style="background: url(./images/200622_dishwasher_PC_bg_1.jpg) no-repeat 50% 50%;background-size: cover">
  <div id="case1">
    <video id="video" autoplay muted></video>
    <canvas id="buffer" style="display: none;"></canvas>
    <canvas id="output"></canvas>
  </div>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js'></script>
  <script>
    (function () {
      var outputCanvas = document.getElementById('output'),
        output = outputCanvas.getContext('2d'),
        bufferCanvas = document.getElementById('buffer'),
        buffer = bufferCanvas.getContext('2d'),
        video = document.getElementById('video'),
        interval;
      var vWidth, vHeight, wWidth, wHeight;
      var isStarted = false;

      function processFrame() {
        var ratio = vWidth/vHeight;
        output.drawImage(video, 0, 0, wWidth*vHeight/vWidth, wHeight);

        // this can be done without alphaData, except in Firefox which doesn't like it when image is bigger than the canvas
        var image = output.getImageData(0, 0, wWidth, wHeight),
          imageData = image.data,
          alphaData = output.getImageData(0, wHeight/2, wWidth, wHeight).data;

        for (var i = 3, len = imageData.length; i < len; i = i + 4) {
          // imageData[i] = alphaData[i - 1];
          imageData[i] = Math.max(alphaData[i - 1], alphaData[i - 2], alphaData[i - 3]);
        }
        output.putImageData(image, 0, 0, 0, 0, wWidth, wHeight);
        requestAnimationFrame(processFrame);
      }

      function fetchVideo() {
        fetch('./video/black-butterfly-alpha.mp4')
          .then(function (response) {
            video.src = response.url;
          })
          .catch(function (error) {
            console.error('Unable this video..');
          });
      }

      fetchVideo();

      video.addEventListener('play', function () {
        if (isStarted) return;
        isStarted = true;

        vWidth = video.videoWidth;
        vHeight = video.videoHeight;
        wWidth = window.innerWidth;
        wHeight = window.innerHeight;
        bufferCanvas.width = wWidth;
        bufferCanvas.height = wHeight;
        outputCanvas.width = wWidth;
        outputCanvas.height = wHeight;
        width = outputCanvas.width;
        height = outputCanvas.height;
        processFrame();
      }, false);

      // Firefox doesn't support looping video, so we emulate it this way
      video.addEventListener('ended', function () {
        video.play();
      }, false);
    })();
  </script>
</body>

</html>